<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>libchaos Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="这是一个扯淡的网站">
<meta property="og:type" content="website">
<meta property="og:title" content="libchaos Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="libchaos Blog">
<meta property="og:description" content="这是一个扯淡的网站">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="libchaos Blog">
<meta name="twitter:description" content="这是一个扯淡的网站">
  
    <link rel="alternative" href="/atom.xml" title="libchaos Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xojpa.com1.z0.glb.clouddn.com/blog.ico">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="http://7xojpa.com1.z0.glb.clouddn.com/portrait.jpg" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">libchaos</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Fake it</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>

				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/tags/随笔">随笔</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/libchaos" title="github">github</a>
					        
						</div>
					</nav>
				</section>

				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/阻塞-非阻塞-IO/" style="font-size: 10px;">阻塞 非阻塞 IO</a>
					</div>
				</section>
				

				

				
			</div>
		</div>
	</header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<h1 class="header-author js-mobile-header hide">libchaos</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="http://7xojpa.com1.z0.glb.clouddn.com/portrait.jpg" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
			</div>
			<hgroup>
			  <h1 class="header-author">libchaos</h1>
			</hgroup>
			
			<p class="header-subtitle">Fake it</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/tags/随笔">随笔</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/libchaos" title="github">github</a>
			        
				</div>
			</nav>
		</header>
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-Q库generator和co库" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/27/Q库generator和co库/" class="article-date">
  	<time datetime="2016-03-27T13:19:45.000Z" itemprop="datePublished">2016-03-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/27/Q库generator和co库/">Q库generator和co库</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Promise模式的q库">Promise模式的q库</h1><p>promise 是一种让异步代码写起来更舒服的模式。<br>q库可运行node下，它是一种promise的实现<br><strong><em>npm i q</em></strong> 来安装它</p>
<p>下面采用回调方式编写<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.readdir(<span class="string">'.'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, rs</span>)</span>&#123;</span><br><span class="line">  fs.readFile(rs[<span class="number">0</span>], <span class="function"><span class="keyword">function</span>(<span class="params">err, f1</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(f1);</span><br><span class="line">    fs.readFile(rs[<span class="number">1</span>], <span class="function"><span class="keyword">function</span> (<span class="params">err, f2</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(f2);</span><br><span class="line">      fs.readFile(rs[<span class="number">2</span>], <span class="function"><span class="keyword">function</span> (<span class="params">err, f3</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(f3);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>采用q库的解决方案</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Q = <span class="built_in">require</span>(<span class="string">'q'</span>),</span><br><span class="line">  fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line">Q.nfcall(fs.readdri, <span class="string">'.'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">ns</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> promises = [];</span><br><span class="line">  ns.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">filename</span>) </span>&#123;</span><br><span class="line">    promises.push(Q.ncall(fs.readFile, filename, <span class="string">'utf-8'</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">  Q.all(promises).then(<span class="function"><span class="keyword">function</span>(<span class="params">results</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(results);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">.fail(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>通过<strong><em>Q.ncall</em></strong>方法调用异步方法，返回一个<strong><em>promise</em></strong>对象，<strong><em>promise</em></strong>对象具有一个then方法，<br>可以运行得到结果。<br>这里<strong><em>var promises = [];</em></strong> 变量用于存储promise数组，把这个参数加入<strong><em>Q.all</em></strong>中，会得到一个promise对象，调用then方法会得到一个数组，这个数组就是所有promise运行的结果。<br>一切都围绕promise对象，它有一个then方法用于返回回调函数的结果，还有一个fail函数，用于返回异常对象，then 和fail不会被同时调用，就好比一个普通函数，如果抛出异常就不会有返回值一样。</p>
<p><strong><em>then</em></strong>代表无异常情况下的返回值，<strong><em>fail</em></strong>表示抛出异常，如果过程中有任何异常，<strong><em>promise.then</em></strong>的函数就不会被调用，而是会调用<strong><em>fail</em></strong>，表示抛出异常。</p>
<hr>
<h1 id="generator">generator</h1><ul>
<li>运行generator代码需要node version&gt;4<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">f</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">f</span>(<span class="params"></span>) </span>&#123;&#125;  </span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">f</span>(<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>以上三种方式都对<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f.constructor; <span class="comment">//function GeneratorFunction()&#123;native code&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>调用生成器函数就会产生一个生成器对象，生成器对象拥有next()方法，用来迭代<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'hello'</span>);</span><br><span class="line">&#125;</span><br><span class="line">f();</span><br></pre></td></tr></table></figure></p>
<p>运行代码后，终端没有打印出“hello”， 这是因为调用生成器函数产生一个生成器对象，但是不会执行里面的代码，需要调用next()函数.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'hello'</span>);</span><br><span class="line">&#125;</span><br><span class="line">f();</span><br><span class="line"><span class="keyword">var</span> g = f();</span><br><span class="line">g.next();</span><br></pre></td></tr></table></figure></p>
<p>g是一个gnerator对象，调用next方法后，将真正进入f的函数体。<br>根据上面的例子，会发现generator有个断点效果，就是在执行方法体之前， 等待next方法。<br>通常generator函数和yeild关键词一起使用。yeild可以理解为一个断点<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">gf</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"start"</span>);</span><br><span class="line">  <span class="keyword">var</span> str = <span class="keyword">yield</span> <span class="string">"hello"</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"result: "</span>, str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = gf();</span><br><span class="line">g.next();</span><br></pre></td></tr></table></figure></p>
<p>调用一次next，进入函数，打印出start,这时遇到yied所以中断了，我们后面继续一个next方法<br>打印出<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g.next()</span><br><span class="line">==&gt; start</span><br><span class="line">==&gt; result: <span class="literal">undefined</span></span><br></pre></td></tr></table></figure></p>
<p>这好像和我想的不一样，第一感觉应该 result: hello 而不是result: undefined, 这是因为yield后面跟着的语句确实返回了， 只不过返回的hello值不是给了str变量，而是在第一次调用g.next(),它会返回一个对象（{ value: ‘hello’, done: false }）， 这个对象里有个value属性， 这个属性的值就是hello</p>
<p>so change the code</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">gf</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"start"</span>);</span><br><span class="line">  <span class="keyword">var</span> str = <span class="keyword">yield</span> <span class="string">"hello"</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"result: "</span>, str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = gf();</span><br><span class="line"><span class="keyword">var</span> value = g.next().value;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"yield value-&gt; "</span>, value);</span><br></pre></td></tr></table></figure>
<p>第一次调用next后，进入函数体， 遇到yield对象，中断了，就是： 中断并把yield的右侧的值， 写入本次调用next生成的对象中， 这个对象的value值就是右侧的值。<br>第二次调用next方法后，yield会把next(args)方法的args值赋予左侧变量， 并继续执行语句，下面的代码是我们想要的结果<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">gf</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"start"</span>);</span><br><span class="line">  <span class="keyword">var</span> str = <span class="keyword">yield</span> <span class="string">"hello"</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"result: "</span>, str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = gf();</span><br><span class="line"><span class="keyword">var</span> value = g.next().value;</span><br><span class="line">g.next(value);</span><br></pre></td></tr></table></figure></p>
<p>Then we get the result what we want…<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start</span><br><span class="line"><span class="literal">result</span>: hello</span><br></pre></td></tr></table></figure></p>
<p>next 方法返回的对象有两个值{value, done}, value 表示yeild右侧的值也可能是generator的返回值； done如果为false，表示后面还有未执行的yeild语句。</p>
<hr>
<h1 id="CO库的介绍">CO库的介绍</h1><p>co 用于优化异步函数调用方式， 支持promise和thunkify</p>
<p>npm i co thunkify</p>
<p>不采用co的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.readdir(<span class="string">'.'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, rs</span>)</span>&#123;</span><br><span class="line">  fs.readFile(rs[<span class="number">0</span>], <span class="function"><span class="keyword">function</span>(<span class="params">err, f1</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(f1);</span><br><span class="line">    fs.readFile(rs[<span class="number">1</span>], <span class="function"><span class="keyword">function</span> (<span class="params">err, f2</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(f2);</span><br><span class="line">      fs.readFile(rs[<span class="number">2</span>], <span class="function"><span class="keyword">function</span> (<span class="params">err, f3</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(f3);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>查看当前目录下有多少文件， 然后逐个读取， 把读取的数据打印到终端， 可笑的是我必须知道，这个目录下有多少文件。。。。</p>
<h2 id="-_留有问题。。。">- 留有问题。。。</h2><h2 id="co_顺序执行下列代码">co 顺序执行下列代码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> co = <span class="built_in">require</span>(<span class="string">'co'</span>),</span><br><span class="line">thunkify = <span class="built_in">require</span>(<span class="string">'thunkify'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">time, callback</span>)</span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    callback(<span class="literal">null</span>, <span class="string">"setTimeout time is - "</span> + time);</span><br><span class="line">  &#125;, time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> func = thunkify(fun);</span><br><span class="line"></span><br><span class="line">co(<span class="function"><span class="keyword">function</span> * (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">yield</span> func(<span class="number">2000</span>));</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">yield</span> func(<span class="number">1000</span>));</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">yield</span> func(<span class="number">5000</span>));</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'ok'</span>);</span><br><span class="line">&#125;).catch((err) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-js-原型" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/11/js-原型/" class="article-date">
  	<time datetime="2016-03-11T15:33:38.000Z" itemprop="datePublished">2016-03-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/11/js-原型/">js_原型</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-异步与同步" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/10/异步与同步/" class="article-date">
  	<time datetime="2016-03-10T11:51:32.000Z" itemprop="datePublished">2016-03-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/10/异步与同步/">异步与同步</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="异步与同步">异步与同步</h1><p>从调用方式上，可以把他们分为3类： 同步调用，回调和异步调用。同步调用是一种阻塞式的调用，调用要等待对方执行完毕才返回，他是一种单向调用；回调是一种双向调用模式，也就是说，被调用方在接口被调用时也会调用对方的接口；异步调用是一种类似消息或事件机制，不过他的调用方向刚好相反， 接口的服务在收到某种讯息或发生某种事件时，会主动通知客户方（就是调用客户方的接口）。</p>
<ul>
<li>实例<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> data = fs.readFileSync(<span class="string">'new.txt'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(data.toString());</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>readFileSync是同步方法，会阻塞直接得到结果后，才继续执行之后的语句。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.readFile(<span class="string">'new.txt'</span>, <span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data.toString());</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'first me run'</span>);</span><br></pre></td></tr></table></figure>
<p>会发现console.log(‘first me run’)先执行。因为readfile是异步函数，不会阻塞之后的语句。callback是回调函数，等到底层读完数据后， 会调用该函数。<br>node.js中回调的函数的规范是：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">err, args0, args1...</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面模拟一个异步函数，和回调函数，加深理解。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sumAsyn</span>(<span class="params">a, b, callback</span>) </span>&#123;</span><br><span class="line">  setTimeout(</span><br><span class="line">    <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">typeof</span> a === <span class="string">'number'</span> &amp;&amp; <span class="keyword">typeof</span> b === <span class="string">'number'</span>)&#123;</span><br><span class="line">        callback(<span class="literal">null</span>, a + b);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'must be number'</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  , <span class="number">200</span>)</span><br><span class="line">&#125;</span><br><span class="line">sumAsyn(<span class="number">2</span>, <span class="number">3</span>, <span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">err, rs</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(rs);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'first run!!'</span>);</span><br></pre></td></tr></table></figure></p>
<p>我们定义一个sumAsyn异步函数，运行后先执行console.log(‘first run!!’)。</p>
<p>在node开始所有i/o应该用异步。</p>
<h2 id="异步">异步</h2><p>所谓”异步”，简单说就是一个任务分成两段，先执行第一段，然后转而执行其他任务，等做好了准备，再回过头执行第二段。</p>
<h2 id="回调函数">回调函数</h2><p>JavaScript语言对异步编程的实现，就是回调函数。所谓回调函数，就是把任务的第二段单独写在一个函数里面，等到重新执行这个任务的时候，就直接调用这个函数。它的英语名字callback，直译过来就是”重新调用”。<br>一个有趣的问题是，为什么Node.js约定，回调函数的第一个参数，必须是错误对象err（如果没有错误，该参数就是null）？原因是执行分成两段，在这两段之间抛出的错误，程序无法捕捉，只能当作参数，传入第二段。</p>
<h2 id="Promise">Promise</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// function asyncFun(a, b, cb) &#123;</span></span><br><span class="line"><span class="comment">//   setTimeout(function () &#123;</span></span><br><span class="line"><span class="comment">//     cb(a + b);</span></span><br><span class="line"><span class="comment">//   &#125;, 200);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// //异步的</span></span><br><span class="line"><span class="comment">// asyncFun(1, 2, function (result) &#123;</span></span><br><span class="line"><span class="comment">//   if(result &gt; 2)&#123;</span></span><br><span class="line"><span class="comment">//     asyncFun(result, 2, function (result) &#123;</span></span><br><span class="line"><span class="comment">//       if(result &gt; 4)&#123;</span></span><br><span class="line"><span class="comment">//         asyncFun(result, 2, function (result) &#123;</span></span><br><span class="line"><span class="comment">//           console.log('ok');</span></span><br><span class="line"><span class="comment">//         &#125;);</span></span><br><span class="line"><span class="comment">//       &#125;</span></span><br><span class="line"><span class="comment">//     &#125;);</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"><span class="comment">// console.log(2);</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncFun</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      resolve(a + b);</span><br><span class="line">    &#125;, <span class="number">200</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">asyncFun(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(result &gt; <span class="number">2</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> asyncFun(result, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(result &gt; <span class="number">4</span>)&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'ok'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>可以看到，Promise 的写法只是回调函数的改进，使用then方法以后，异步任务的两段执行看得更清楚了，除此以外，并无新意。</p>
<p>Promise 的最大问题是代码冗余，原来的任务被Promise 包装了一下，不管什么操作，一眼看去都是一堆 then，原来的语义变得很不清楚。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-javascript异步" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/10/javascript异步/" class="article-date">
  	<time datetime="2016-03-10T11:48:23.000Z" itemprop="datePublished">2016-03-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/10/javascript异步/">javascript异步</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-异步解决方案" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/10/异步解决方案/" class="article-date">
  	<time datetime="2016-03-10T11:47:42.000Z" itemprop="datePublished">2016-03-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/10/异步解决方案/">异步解决方案</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-connect-md" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/12/connect-md/" class="article-date">
  	<time datetime="2015-10-12T12:08:44.000Z" itemprop="datePublished">2015-10-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/12/connect-md/">connect.md</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="connect_中间件_实现一个登录网站">connect 中间件 实现一个登录网站</h2><hr>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">var connect = require('connect')</span><br><span class="line">, users = require('./users')</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var server = connect(</span><br><span class="line">    connect.logger('dev'),</span><br><span class="line">    connect.bodyParser(),</span><br><span class="line">    connect.cookieParser(),</span><br><span class="line">    connect.session(&#123;secret: 'my app secret'&#125;),</span><br><span class="line">    function(req, res, next)&#123;</span><br><span class="line">        if('/' == req.url &amp;&amp; req.session.logged_in)&#123;</span><br><span class="line">            res.writeHead(200, &#123;'Content-Type': 'text/html'&#125;);</span><br><span class="line">            res.end(</span><br><span class="line">                'welcome back, &lt;b&gt;' + req.session.name + '&lt;/b&gt;'</span><br><span class="line">                + '&lt;a href="/logout"&gt;LogOUT&lt;/a&gt;');</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            next();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    function(req, res, next)&#123;</span><br><span class="line">        if('/' == req.url &amp;&amp; 'GET' == req.method)&#123;</span><br><span class="line">            res.writeHead(200, &#123;'Content-Type': 'text/html'&#125;);</span><br><span class="line">            res.end([</span><br><span class="line">                '&lt;form action="/login" method="POST"&gt;',</span><br><span class="line">                '&lt;fieldset&gt;',</span><br><span class="line">                '&lt;legend&gt;Please log in&lt;/legend&gt;</span><br><span class="line">',</span><br><span class="line">                '&lt;p&gt;User: &lt;input type="text" name = "user"&gt;&lt;/p&gt;</span><br><span class="line">',</span><br><span class="line">                '&lt;button&gt;submit&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">',</span><br><span class="line">                '&lt;/fieldset&gt;','&lt;/form&gt;'</span><br><span class="line">                ].join(''));</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            next();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    function(req, res, next)&#123;</span><br><span class="line">        if('/login' == req.url &amp;&amp; 'POST' ==  req.method)&#123;</span><br><span class="line">            res.writeHead(200);</span><br><span class="line">            if(!users[req.body.user] || req.body.password != users[req.body.user].password)&#123;</span><br><span class="line">                res.end('bad user name/password!');</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                req.sessoin.logged_in = true;</span><br><span class="line">                req.session.name = users[req.body.user].name;</span><br><span class="line">                res.end('Authenticated!')</span><br><span class="line"></span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                next();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    function(req, res, next)&#123;</span><br><span class="line">        if('/logout' == req.url)&#123;</span><br><span class="line">            req.session.logged_in = false;</span><br><span class="line">            req.writeHead(200);</span><br><span class="line">            res.end('logged out');</span><br><span class="line"></span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            next();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-简单的web服务器" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/08/简单的web服务器/" class="article-date">
  	<time datetime="2015-10-08T01:44:06.000Z" itemprop="datePublished">2015-10-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/08/简单的web服务器/">简单的web服务器</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="一个简单的web服务器">一个简单的web服务器</h1><h2 id="创建模块">创建模块</h2><h2 id="输出表单">输出表单</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> qs = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="string">'/'</span> == req.url)&#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>&#125;);</span><br><span class="line">    res.end([</span><br><span class="line">      <span class="string">'&lt;form method = "POST" action="/url"&gt;'</span>,</span><br><span class="line">      <span class="string">'&lt;h1&gt;My form&lt;/h1&gt;'</span>,</span><br><span class="line">      <span class="string">'&lt;fieldset&gt;'</span>,</span><br><span class="line">      <span class="string">'&lt;label&gt;Personal Information&lt;/label&gt;'</span>,</span><br><span class="line">      <span class="string">'&lt;p&gt;What is your name?&lt;/p&gt;'</span>,</span><br><span class="line">      <span class="string">'&lt;input type="text" name = "name"&gt;'</span>,</span><br><span class="line">      <span class="string">'&lt;p&gt;&lt;button&gt;Submit&lt;/button&gt;&lt;/p&gt;'</span>,</span><br><span class="line">      <span class="string">'&lt;/form&gt;'</span></span><br><span class="line">    ].join(<span class="string">''</span>));</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">'/url'</span> ==  req.url &amp;&amp; <span class="string">'POST'</span> == req.method)&#123;</span><br><span class="line">    <span class="keyword">var</span> body = <span class="string">''</span>;</span><br><span class="line">    req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;</span><br><span class="line">      body += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>&#125;);</span><br><span class="line">      <span class="comment">// res.end('&lt;p&gt;Content-Type: ' + req.headers['content-type'] + '&lt;/p&gt;'</span></span><br><span class="line">      <span class="comment">//   +'&lt;p&gt; Data: &lt;/p&gt;&lt;pre&gt;' + body + '&lt;/pre&gt;'</span></span><br><span class="line">      <span class="comment">//   );</span></span><br><span class="line">      res.end(<span class="string">'&lt;p&gt;Your name is &lt;b&gt;'</span> + qs.parse(body).name + <span class="string">'&lt;/b&gt;&lt;/p&gt;'</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    res.writeHead(<span class="number">404</span>);</span><br><span class="line">    res.end(<span class="string">'Not Found'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// &#125;else if('/url' == req.url)&#123;</span></span><br><span class="line">  <span class="comment">//   res.writeHead(200, &#123;'Content-Type': 'text/html'&#125;);</span></span><br><span class="line">  <span class="comment">//   res.end('You sent a &lt;em&gt;' + req.method + '&lt;/em&gt; request!');</span></span><br><span class="line">&#125;).listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h2 id="一个twitter的web_客户端">一个twitter的web 客户端</h2><ol>
<li>发送一个简单的HTTP请求<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'http'</span>).request(&#123;</span><br><span class="line">    host: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">    port: <span class="number">3000</span>,</span><br><span class="line">    url: <span class="string">'/'</span>,</span><br><span class="line">    method: <span class="string">'GET'</span>,</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body = <span class="string">''</span>;</span><br><span class="line">    res.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">    res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;</span><br><span class="line">        body += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'\n We got: \033[96m'</span> + body + <span class="string">'\033[38m\n'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).end();</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h2 id="一个简单的http_web服务器">一个简单的http web服务器</h2><p>//回到createServer的回调函数，我们需要检查URL是否和服务器的目录下的文件匹配，如果匹配，则读取该文件并展示出来。以后，可能会添加更多的图片，所以要确保灵活以支持这种情况。<br>// 首先 要检查请求方法是GET并且URL以/images开始，.jpg结束。如果URL 为/的话，则响应index.html(调用后面要实现的serve函数)。否则，发送404 not found。接着，使用fs.stat来检查文件是否存在。者里使用NODE中全局常量__dirname来获取当前服务器所在的路劲。在首个if语句后，添加如下代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">'GET'</span> == req.method &amp;&amp; <span class="string">'/images'</span> == req.url.substr(<span class="number">0</span>, <span class="number">7</span>) &amp;&amp; <span class="string">'.jpg'</span> == req.url.substr(<span class="number">-4</span>))&#123;</span><br><span class="line">        fs.stat(__dirname + req.url, <span class="function"><span class="keyword">function</span>(<span class="params">err, stat</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(err || !stat.isFile())&#123;</span><br><span class="line">                res.writeHead(<span class="number">404</span>);</span><br><span class="line">                res.end(<span class="string">'not found'</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            serve(__dirname + req.url, <span class="string">'application/jpg'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">'GET'</span> == req.method &amp;&amp; <span class="string">'/'</span> == req.url)&#123;</span><br><span class="line">        serve(__dirname+<span class="string">'/index.html'</span>, <span class="string">'text/html'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.writeHead(<span class="number">404</span>);</span><br><span class="line">        res.end(<span class="string">'not found'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">serve</span>(<span class="params">path, type</span>)</span>&#123;</span><br><span class="line">        res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: type&#125;);</span><br><span class="line">        fs.createReadStream(path).pipe(res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'server listening in 3000...'</span>);</span><br></pre></td></tr></table></figure>
<p>中间件<br>通过connect来实现一个简单的网站</p>
<ul>
<li>托管静态文件</li>
<li>处理错误以及损坏的的URL</li>
<li>处理不同类型的请求</li>
</ul>
<p>基于http模块api上的connect，提供了一些工具方法能够让这些重复性的处理便于实现。DRY</p>
<p>引入模块<br>var connect = require(‘connect’);<br>var server = connect.createServer();<br>使用use()方法来添加static中间件。下一部分会介绍中间件的概念<br>中间件其实就是一个简单的javascript函数。本例中，我们这样配置static中间件—通过传递一些参数给connect.static方法，该方法本身会返回一个方法。</p>
<p>处理静态文件</p>
<p>serve.use(connect.static(__dirname + ‘/website’));<br>将index.html以及images目录放到/website下，确保没有将不想托管的文件放进去</p>
<p>server.listen(3000);</p>
<p>中间件</p>
<p>if(‘GET’ == req.method …){</p>
<p>}else if(‘GET’ == req.method){</p>
<p>}else{<br>    res.writeHead(404);<br>    res.end();<br>}<br>如上述代码描述，针对每个请求应用都只会做三件事情中的一件，比如： 若还要记录请求日志，就在顶部加上如下代码：<br>    console.error(‘ %s %s ‘, req.method, req,url);<br>下面让我来设计一个大型应用，它能够根据每个请求的不同情况下处理以下者集中不同的任务：</p>
<ul>
<li>记录请求处理的时间</li>
<li>托管静态文件</li>
<li>处理授权</li>
</ul>
<p>当然，这些任务的处理代码可以放在一个事件处理器中(createServer的回调函数中)，这将是一个非常复杂的处理过程。<br>简单来说，中间件由函数组成，它除了处理req和res对象之外，还接收一个next函数来做流控制。<br>若用中间件模式来书写上述要求的应用，会是这样子<br>server.use(function(req, res, next){<br>    //记录日志<br>    console.error(‘ %s %s ‘, req.method, req.url);<br>    next();<br>});</p>
<p>server.use(function(req, res, next){<br>    if(‘GET’ == req.method &amp;&amp; ‘/images’==req.url.substr(0, 7)){<br>        //托管图片<br>    }else{<br>        //交给其他中间件<br>        next();<br>    }<br>});</p>
<p>server.use(function(req, res, next){<br>    if(‘GET’ == req.method &amp;&amp; ‘/‘ == req.url){<br>        //响应index文件<br>    }else{<br>        //交给其他中间件<br>        next();<br>    }<br>});</p>
<p>server.use(function(req, res, next){<br>    //最后一个中间件，如果到了这里，就意味着无能为力，只能返回404了<br>    res.writeHead(404);<br>    res.end(‘not found’);<br>});</p>
<p>使用中间件，不仅能够让代码有更强大的表啊能力（将应用拆分为更小的单元）<br>能够实现很好的重用性。我们马上就会看到，Connect已经为处理常见的任务提供了对应的中间件。例如： 要对请求进行日志记录，就可以简单的通过下面一行代码完成：</p>
<p>app.use(connect.logger(‘dev’));<br>帮你完成日志记录<br>下一部分会介绍如何书写一个当请求处理时间长而进行警告的中间件</p>
<h2 id="书写可重用的中间件">书写可重用的中间件</h2><pre><code>一个用于当请求时间过长而进行提醒的中间件在很多场景下都非常有用。比如：
当页面会向数据库发起一系列的请求。在测试过程中，所有响应都在<span class="number">100</span>ms内完成，但是你要确保能够将响应大于<span class="number">100</span>ms的请求记录下来。
为此，我们在一个名为request-time.js的独立模块中创建一个中间件。
这个模块暴露一个函数，此函数本身又返回一个函数。这对于可配置的中间件来说是很常见的写法。在前面的例子中，我们调用connect.logger时传递一个参数，然后他自身会返回一个函数，最终来处理请求。

目前，模块就接收一个超时时间阀值选项，该选项用来界定什么时候将其记录下来。
</code></pre><p>/**</p>
<ul>
<li>请求时间中间件</li>
<li>选项</li>
<li>-’time’(‘Number’): 超市阀值</li>
<li>@param (object) options</li>
<li>@api public<br>*/</li>
</ul>
<p>module.exports = function(){<br>    //….<br>};</p>
<p>首先将阀值设为100<br>var time = opt.time || 100;<br>随后返回一个中间件函数<br>return function(req, res, next){<br>    //中间件本身创建一个计时器，并在指定时间的内触发<br>    var timer = setTimeout(function(){<br>        console.log(<br>            ‘\033[90m%s %s\033[39m \033[91m mis taking too long’, req.method, req.url<br>            );<br>    }, time);<br>    //这里确保当响应时间在100ms以内时要清除（停下来或者取消）计时器。另外一个中间件中常用的模式叫做重写方法(猴子补丁), 能够在其他中间件调用它时，执行指定的行为。<br>    //在本咧中，当响应结束时，我们需要清除计时器<br>    var end = res.end;<br>    res.end = function(chunk, encoding){<br>        res.end = end;<br>        res.end(chunk, encoding);<br>        clearTimeout(timer);<br>    };<br>    //首先保持对原始函数的引用（var end = res.end) 然后在重写函数中，在恢复原始函数，并调用它，最后清除计时器。<br>//最后，总是要其他中间能够处理请求，所以得调用next，否则，程序不会做任何事情去。<br>    next();</p>
<p>}</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-javaScript-Design" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/07/javaScript-Design/" class="article-date">
  	<time datetime="2015-10-07T13:14:59.000Z" itemprop="datePublished">2015-10-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/07/javaScript-Design/">javaScript_Design</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="原型模式">原型模式</h1><p>文字方式</p>
<ul>
<li>原型模式（prototype）是指原型实例指向创建对象的种类，并且通过拷贝这些<br>原型创建新对象。<br>Object.create(prototype, OptionnalDes)</li>
</ul>
<p>拟物化</p>
<p>  袋鼠和袋鼠崽子</p>
<p>  作用<br>  1.原型对象本身就是有效利用了每个构造创建的对象<br>  注意事项：<br>  1.注意浅拷贝和深拷贝</p>
<h2 id="代码实战">代码实战</h2>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span><br><span class="line">    <span class="comment">//原型</span></span><br><span class="line">    <span class="keyword">var</span> myobj = &#123;</span><br><span class="line">        str: <span class="string">"mysting"</span>,</span><br><span class="line">        num: <span class="number">1</span>,</span><br><span class="line">        myarr: [],</span><br><span class="line">        myobj: &#123;</span><br><span class="line">            innerobj: &#123;</span><br><span class="line">                test: <span class="number">25</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">clone</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// var ret = &#123;&#125;, k;</span></span><br><span class="line">        <span class="comment">// for(k in obj)&#123;</span></span><br><span class="line">        <span class="comment">//     ret[k] = obj[k];</span></span><br><span class="line">        <span class="comment">//  &#125;</span></span><br><span class="line">        <span class="keyword">var</span> ret, k, b;</span><br><span class="line">        <span class="keyword">if</span>((b = (obj <span class="keyword">instanceof</span> <span class="built_in">Array</span>))|| obj <span class="keyword">instanceof</span> <span class="built_in">Object</span>)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'init'</span>);</span><br><span class="line">            ret = b?[]: &#123;&#125;;</span><br><span class="line">            <span class="keyword">for</span>(k <span class="keyword">in</span> obj)&#123;</span><br><span class="line">                <span class="keyword">if</span>(obje[k] <span class="keyword">instanceof</span> <span class="built_in">Array</span> || obj[k] <span class="keyword">instanceof</span> <span class="built_in">Object</span>)&#123;ret[k] = clone(obj[k]);&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    ret[k] = obj[k];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//浅拷贝</span></span><br><span class="line">    <span class="keyword">var</span> result = clone(myobj);</span><br><span class="line">    result.myobj.innerobj[test] = <span class="number">12</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="装饰者模式">装饰者模式</h2><p>装饰者用于包装同接口的对象，向方法添加行为，还可以设置为引用。</p>
<p>装饰着用于通过重载方法的形式添加新功能，该模式可以在被装饰者前面或者后面<br>加上自己行为以达到特定的目的。</p>
<p>装饰家居<br>    给门上加上花边</p>
<pre><code><span class="comment"><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> home = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">home.prototype.space = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'我是一个空房子'</span>);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> zhuangshi = <span class="function"><span class="keyword">function</span>(<span class="params">home</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.zfangzi = home;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zhuangshi.prototype.space = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.zfangzi.space();</span><br><span class="line">    conosole.log(<span class="string">'我添加了一个家居'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> _fangzi = <span class="keyword">new</span> home();</span><br><span class="line"><span class="keyword">var</span> _zhuangshi = <span class="keyword">new</span> zhuangshi(_fangzi);</span><br><span class="line">_zhuangshi.space();</span><br></pre></td></tr></table></figure></span>
</code></pre><h2 id="组合模式">组合模式</h2><p>  将对象组合成树形结构以表示“部分-整体  ”</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-TCP" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/07/TCP/" class="article-date">
  	<time datetime="2015-10-07T05:41:39.000Z" itemprop="datePublished">2015-10-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/07/TCP/">TCP</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>&#125;);</span><br><span class="line">  res.end(<span class="string">'&lt;h1&gt;Hello, world!!!&lt;/h1&gt;'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>$ telnet 127.0.0.1</p>
<p>GET /HTTP/1.1</p>
<ul>
<li>成功建立一个tcp连接</li>
<li>创建一个HTTP请求</li>
<li>接收到一个HTTP响应</li>
<li>测试了一些TCP的特性。到达数据和在node中写的一样： 先写Content-Type响应头，然后是响应体<br>，最后所有信息都按序到达。</li>
</ul>
<h2 id="基于TCP的聊天程序">基于TCP的聊天程序</h2><p>下面创建一个基本的TCP服务器，并要求输入用户名。同事还回告诉你协议和指令。</p>
<ul>
<li>成功连接到服务器后，服务器会显欢迎信息，并要求输入用户名。同时，还会告诉你当前还有多少其他客户端<br>也连接上该服务器。</li>
<li>输入用户名，按下回车键后，就认为成功连接上。</li>
<li>连接后，就可以输入信息在按下回车键，来项其他客户端进行消息的收发。</li>
</ul>
<p>为什么输入回车，在node中，通过\n来判断消息是否已将完到达。所以，作为一个分割符使用。</p>
<ol>
<li><p>创建模块<br>npm init</p>
</li>
<li><p>理解NET.SERVER API<br>接下来，创建index.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"><span class="comment">//createServer</span></span><br><span class="line"><span class="keyword">var</span> server = net.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">conn</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//handle connection</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'\033[90m new Connections!\033[39m'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//listen</span></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'\033[96m server listening on *:3000\033[39m'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-python算法" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/09/25/python算法/" class="article-date">
  	<time datetime="2015-09-25T11:02:40.000Z" itemprop="datePublished">2015-09-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/09/25/python算法/">python算法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="python_数据结构">python 数据结构</h1><h3 id="栈">栈</h3><p>  一端开口，一端封闭的容器，栈只能对其栈顶的数据进行操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stack</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(st, size)</span>:</span></span><br><span class="line">    st.stack = []</span><br><span class="line">    st.size = size</span><br><span class="line">    st.top = <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(st, content)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> st.Full():</span><br><span class="line">      <span class="keyword">print</span> <span class="string">"Stack is full."</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      st.stack.append(content)</span><br><span class="line">      st.top += <span class="number">1</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(st)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> st.Empty():</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      st.top -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">Full</span><span class="params">(st)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> st.top == st.size:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">Empty</span><span class="params">(st)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> st.top == <span class="number">-1</span>:</span><br><span class="line">      <span class="keyword">print</span> <span class="string">"Stack is Empty!"</span></span><br></pre></td></tr></table></figure>
<h3 id="队列">队列</h3><p>两端都通的容器， 一端只能删， 一端只能进<br>数据流向是单向的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Queue</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(qu, size)</span>:</span></span><br><span class="line">    qu.queue = []</span><br><span class="line">    qu.size = size</span><br><span class="line">    qu.head = <span class="number">1</span></span><br><span class="line">    qu.tail = <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">Empty</span><span class="params">(qu)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> qu.head == qu.tail:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">Full</span><span class="params">(qu)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> qu.tail - qu.head + <span class="number">1</span> == size:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">enQueue</span><span class="params">(qu, content)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> qu.Full():</span><br><span class="line">      <span class="keyword">print</span> <span class="string">"Queue is Full!!"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      qu.queue.append(content)</span><br><span class="line">      qu.tail += <span class="number">1</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">outQueue</span><span class="params">(qu)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> qu.Empty():</span><br><span class="line">      <span class="keyword">print</span> <span class="string">"queue is empyt..."</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      qu.head += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="链表">链表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data, next=None)</span>:</span></span><br><span class="line">    self.data = data</span><br><span class="line">    self.next = next</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LinkList</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, node)</span>:</span></span><br><span class="line">    self.head = node</span><br><span class="line">    self.head.next = <span class="keyword">None</span></span><br><span class="line">    self.tail = self.head</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, node)</span>:</span></span><br><span class="line">    self.tail.next = node</span><br><span class="line">    self.tail = self.tail.next</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">view</span><span class="params">(self)</span>:</span></span><br><span class="line">    node = self.head</span><br><span class="line">    link_str = <span class="string">' '</span></span><br><span class="line">    <span class="keyword">while</span> node <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">      <span class="keyword">if</span> node.next <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        link_str = link_str + str(node.data) + <span class="string">"--&gt;"</span></span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        link_str += str(node.data)</span><br><span class="line">      node = node.next</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> link_str</span><br></pre></td></tr></table></figure>
<h3 id="二叉树">二叉树</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BtreeNode</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, lft=None, rgh=None, data=<span class="number">0</span>)</span>:</span></span><br><span class="line">    self.lft = lft</span><br><span class="line">    self.rgh = rgh</span><br><span class="line">    self.data = data</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Btree</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, base=None)</span>:</span></span><br><span class="line">    self.base = base</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">empty</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> self.base <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">qout</span><span class="params">(self, node)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> node <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">print</span> node.data</span><br><span class="line">    self.qout(node.lft)</span><br><span class="line">    self.qout(node.rgh)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">mout</span><span class="params">(self, node)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> node <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    self.mout(node.lft)</span><br><span class="line">    <span class="keyword">print</span> node.data</span><br><span class="line">    self.mout(node.rgh)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">hout</span><span class="params">(self, node)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> node <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    self.hout(node.lft)</span><br><span class="line">    self.hout(node.rgh)</span><br><span class="line">    <span class="keyword">print</span> node.data</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">##bitmap</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bitmap</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, max)</span>:</span></span><br><span class="line">    self.size = int((max + <span class="number">31</span> <span class="number">-1</span>) / <span class="number">31</span>)</span><br><span class="line">    self.array = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(self.size)]</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">bit_index</span><span class="params">(self, num)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> num % <span class="number">31</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">set</span><span class="params">(self, num)</span>:</span></span><br><span class="line">    elem_index = num / <span class="number">31</span></span><br><span class="line">    byte_index = self.bit_index(num)</span><br><span class="line">    elem = self.array［elem_index］  </span><br><span class="line">    self.array[elem_index] = elem | (<span class="number">1</span> &lt;&lt; byte_index)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self, i)</span>:</span></span><br><span class="line">    elem_index = i / <span class="number">31</span></span><br><span class="line">    byte_index = self.bit_index(i)</span><br><span class="line">    <span class="keyword">if</span> self.array[elem_index] &amp; (<span class="number">1</span> &lt;&lt; byte_index):</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">  MAX = ord(<span class="string">'z'</span>)</span><br><span class="line">  suffle = [x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="string">'coledraw'</span>]</span><br><span class="line">  res = []</span><br><span class="line">  bitmap = Bitmap(MAX)</span><br><span class="line">  <span class="keyword">for</span> c <span class="keyword">in</span> suffle:</span><br><span class="line">    bitmap.set(ord(c))</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(MAX + <span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> bitmap.test(i):</span><br><span class="line">      res.append(chr(i))</span><br><span class="line">  <span class="keyword">print</span> <span class="string">'%s'</span> %suffle</span><br><span class="line">  <span class="keyword">print</span> <span class="string">'ordered %s'</span> %res</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#图的视线</span></span><br><span class="line">chart ＝  &#123;<span class="string">'A'</span>:[<span class="string">"B"</span>, <span class="string">"D"</span>], <span class="string">'C'</span>:[<span class="string">'E'</span>], <span class="string">'D'</span>:[<span class="string">'C'</span>, <span class="string">'E'</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">path</span><span class="params">(chart, x, y, pathd=[])</span>:</span></span><br><span class="line">  pathd = pathd + [x]</span><br><span class="line">  <span class="keyword">if</span> x == y:</span><br><span class="line">    <span class="keyword">return</span> pathd</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> chart.has_key(x):</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">  <span class="keyword">for</span> node <span class="keyword">in</span> chart[x]:</span><br><span class="line">    <span class="keyword">if</span> node <span class="keyword">not</span> <span class="keyword">in</span> pathd:</span><br><span class="line">      new_node = path(chart, node, y, pathd)</span><br><span class="line">      <span class="keyword">if</span> new_node:</span><br><span class="line">        <span class="keyword">return</span> new_node</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#quicksort</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quicksort</span><span class="params">(array, i, j)</span>:</span></span><br><span class="line">  <span class="keyword">if</span> i &lt; j:</span><br><span class="line">    base = find_sorted_index(array, i, j)</span><br><span class="line">    quicksort(array, i, base)</span><br><span class="line">    quicksort(array, base+<span class="number">1</span>, j)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_sorted_index</span><span class="params">(array, i, j)</span>:</span></span><br><span class="line"></span><br><span class="line">  base = array[i]</span><br><span class="line">  <span class="keyword">while</span> i &lt; j:</span><br><span class="line">    <span class="keyword">while</span> i &lt; j <span class="keyword">and</span> array[j]&gt;=base:</span><br><span class="line">      j -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; j <span class="keyword">and</span> array[j] &lt; base:</span><br><span class="line">      array[i] = array[j]</span><br><span class="line">      i += <span class="number">1</span></span><br><span class="line">      array[j] = array[i]</span><br><span class="line">  array[i] = base</span><br><span class="line">  <span class="keyword">return</span> i</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#select sorted</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mergesort</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 libchaos
    	</div>
    </div>
  </div>
</footer>

    </div>
    
  </div>
</body>
</html>